## Compute > Monitoring V2 > 콘솔 사용 가이드


## 단일 인스턴스 상태 조회(인스턴스 관리 페이지에서 제공)

TOAST 콘솔에서 **Compute > Instance > 관리**를 선택합니다. `조회할 인스턴스`를 선택합니다. 화면 아래 **모니터링** 탭에서 해당 인스턴스의 모니터링 그래프를 조회할 수 있습니다.

> [알림]
> Monitoring V2 서비스 제공 이전에 생성된 인스턴스에 이 기능을 사용하려면, 해당 인스턴스의 **모니터링** 탭에서 제공되는 설치 가이드에 따라 에이전트를 설치해야 합니다.<br>
> 에이전트 설치 후 **모니터링 탭**에 그래프가 표시되면, 그 시점부터 Monitoring V2의 기능을 활용할 수 있습니다.

모든 그래프는 조회 시점을 기준으로 `지난 1시간` 동안의 데이터를 보여주며, 자동 업데이트 기능은 없습니다.
대신 그래프 영역 왼쪽 위의 **새로 고침** 버튼을 클릭하면 최신 데이터를 확인할 수 있습니다(수동 업데이트 기능).

![CPU usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_001.jpg) 

각 그래프 설명은 다음과 같습니다.

| 그래프        |  지표 설명          |
|:--------------|----------------|
|CPU 사용률     | total: 총 CPU 사용률(%)<br>sys: 커널 모드 작업에 소요된 CPU 사용률(%)<br>usr: 유저 모드 작업에 소요된 CPU 사용률(%) |
|CPU 평균 부하  | 1m: 지난 1분 동안 CPU를 사용한 프로세스 개수(대기 상태 포함)의 평균<br>5m: 지난 5분 동안 CPU를 사용한 프로세스 개수(대기 상태 포함)의 평균<br>15m: 지난 15분 동안 CPU를 사용한 프로세스 개수(대기 상태 포함)의 평균<br><br> *[참고] 본 지표는 Linux 인스턴스 전용 지표입니다.<br>(Windows 인스턴스는 그래프는 표시되지만 데이터는 제공되지 않습니다.)* |
|메모리 사용률  | used: 메모리 사용률(%)<br>swapused: 스와프 사용률(%)<br><br>*[참고] Linux 인스턴스의 메모리 사용률 계산 시 버퍼 및 캐시 영역은 사용 가능한 영역으로 간주하여 사용량에 포함하지 않습니다.*<br>*[참고] Windows 인스턴스의 스와프 사용률은 페이지 파일 사용럄을 기반으로 계산되며, 물리 메모리 크기는 고려되지 않습니다.* |
|디스크 사용률    | io: 디스크 장치 사용률(%)<br> used: 디스크 공간 사용률(%)<br><br>*[참고] io 및 used는 마운트 상태의 파일 시스템(Windows의 경우 디스크 드라이브)별로 제공됩니다.* |
|디스크 전송률    | read: 디스크 읽기 전송률(Bps)<br>write: 디스크 쓰기 전송률(Bps)<br><br>*[참고] read 및 write는 마운트 상태의 파일 시스템(Windows의 경우 디스크 드라이브)별로 제공됩니다.*<br>*[참고] y축 기본 단위는 Bps(Bytes per Sec)이며, 값의 크기에 따라 단위가 변환됩니다.* |
|네트워크 전송률 | In: 네트워크 읽기 전송률(Bps)<br>Out: 네트워크 쓰기 전송률(Bps)<br><br>*[참고] In 및 Out은 네트워크 장치별로 제공됩니다.*<br>*[참고] y축 기본 단위는 Bps(Bytes per Sec)이며, 값의 크기에 따라  y축 단위가 변환됩니다.* |




## 복수 인스턴스 상태 조회
**Server Details** 탭(아래 그림)의 각 그래프에서는 선택한 인스턴스의 지표를 동시에 확인할 수 있습니다.
![server details image<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_002.jpg)

### 1.인스턴스 목록(화살표 1 영역)
에이전트 구동 이력이 있는 인스턴스의 목록을 확인할 수 있습니다.
> [참고]
> 에이전트 구동 이력이 있으나 현재 에이전트가 종료된 인스턴스, 또는 종료 상태의 인스턴스도 해당 목록에 포함됩니다. 
> 이와 같은 인스턴스는 상태 필드값이 'inActive'로 표시됩니다.

목록에서 선택된 인스턴스는 그래프에 자동으로 반영됩니다(복수 선택 가능).

인스턴스 목록에서도 각 인스턴스의 기본 정보 및 리소스 사용률(조회/업데이트 시점 기준)을 확인할 수 있습니다.
>[참고]
> 인스턴스 목록의 Disk Read, Disk Write 값은 해당 인스턴스의 모든 디스크에 대해 동일 지표별로 합산한 값을 보여줍니다.
> 인스턴스 목록의 Network RX, Network TX 값은 해당 인스턴스의 모든 네트워크 장치에 대해 동일 지표별로 합산한 값을 보여줍니다.

모든 필드에 대한 검색 기능을 이용하면 원하는 대상을 쉽게 골라서 볼 수 있습니다.

### 2.그래프(화살표 2 영역)
**모니터링** 탭과 마찬가지로 6개의 그래프를 제공하지만, 여기에서 각 그래프는 선택된 모든 인스턴스에 대한 지표를 동시에 제공합니다.

>[참고]
>다음의 두 그래프는 **모니터링** 탭에서와는 달리 일부 지표만 제공됩니다.<br>
>CPU Usage 그래프: 각 인스턴스의 total 사용률만 제공
>Memory Usage 그래프: 각 인스턴스의 memory 사용률(used)만 제공

그래프 위에 마우스 커서를 올리면, 커서가 가리키는 시점(x축)의 지푯값이 표시됩니다.
또한 커서를 올리지 않은 그래프에서도 동일한 시점의 지푯값이 함께 표시됩니다(shared-tooltip 기능).

>[참고]
>선택한 인스턴스의 개수가 많은 경우, 그래프의 가독성이 떨어질 수 있습니다.

### 3.조회 기간 지정(화살표 3 영역)
그래프 조회 기간을 설정해 원하는 시점의 인스턴스 상태를 확인할 수 있습니다.
> [참고]
> 그래프 조회 가능 시점은 현재를 기준으로 `과거 1년`까지입니다.

| 설정 항목  | 의미  |
| ---------- | ----- |
| 1 hour  | 현재 기준 지난 한 시간 동안의 데이터 조회 |
| 24 hour | 현재 기준 지난 하루 동안의 데이터 조회 |
| 1 week  | 현재 기준 지난 일주일 동안의 데이터 조회 |
| 1 month | 현재 기준 지난 한 달 동안의 데이터 조회 |
| Custom  | 사용자가 직접 조회 기간을 지정(시작 시점 및 종료 시점) |

### 4.그래프 업데이트 주기 설정 (화살표 4 영역)
모든 그래프에서 자동으로 '새로 고침' 기능을 사용할 수 있습니다.
'off'로 설정된 경우에는 그래프를 '새로 고침'하지 않습니다.
'off'가 아닌 경우에는 해당 값으로 표시되는 시간을 주기로 그래프가 자동으로 '새로 고침'되지 않습니다.

## 알람 정책 설정
**Alarm Setting** 탭에서는 알람 정책 목록을 조회하고 알람 정책을 생성, 수정, 삭제할 수 있습니다.

![alarm policy<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_003.jpg)

알람 정책은 인스턴스 상태 감시를 위한 각종 설정 내역을 담고 있으며, 이를 기준으로 사용자는 인스턴스 상태에 따른 알람을 받을 수 있습니다.
>[참고]
>알람을 받으려면 별도의 [알람 수신자 및 수신 방법을 설정](./console-guide/#_4)해야 합니다.

Monitoring V2 서비스에서는 기본적으로 `Default 정책`을 제공하며, 이 정책은 수정할 수 있으나 삭제할 수는 없습니다.
>[참고]
>모니터링 서비스 등록(에이전트 최초 구동 시 수행) 직후의 인스턴스에는 Default 정책이 적용됩니다.
>인스턴스에 적용하려는 알람 정책은 언제든지 변경할 수 있습니다.

>[주의]
>모든 인스턴스는 오직 하나의 알람 정책에만 포함될 수 있습니다.
>알람 정책을 삭제하면, 해당 정책의 적용을 받던 모든 인스턴스들은 어떠한 알람 정책에도 속하지 않는 상태가 됩니다.

알람 정책으로 감시할 수 있는 항목은 다음과 같습니다.
![alarm configuration<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_004.jpg)

>[참고] 아래 표의 '설정 항목' 필드값 설명<br>
> 사용 여부: 해당 항목의 사용 여부를 설정(on/off)<br>
> 임곗값: 해당 항목의 알람을 받기를 원하는 상태의 최솟값. warn 및 fatal의 두 단계로 설정 가능<br>
> Duration: 해당 항목의 설정 내역(사용 여부 및 임곗값)에 따른 이벤트 감지 후, 실제로 알람을 발송하기까지 해당 상태가 지속되어야 하는 시간(즉, 해당 상태가 Duration으로 지정된 시간 이내에 해소되는 경우 알람은 발생하지 않음)<br>

| 감시 대상 | 설정 항목 | 용도 | 설명 |
|-----------|-----------|------|------|
| 재부팅 | 사용 여부 | 인스턴스 재부팅을 감시 | 인스턴스 재부팅이 완료된 시점에 알람 발생<br><br>*[참고] 재부팅 알람 발송 후 `10분 이내의 재부팅`은 무시(알람 발송 안 함)* |
| No Data | 사용 여부<br>Duration |에이전트의 데이터 미전송 상태 감시 | 데이터 미전송을 최초로 감지한 후, Duration에 설정된 시간 동안 계속 해당 상태가 지속되는 경우 알람 발송 |
| CPU | 사용 여부<br>임곗값(warn, fatal)<br>Duration(warn, fatal) | CPU 사용률(%) 감시 | 총 CPU 사용률에 두 단계(warn, fatal)로 임곗값 설정<br>설정된 임곗값에 도달 후, Duration으로 지정된 시간 이후에도 해당 상태가 지속될 때 알람 발송 |
| 메모리 | 사용 여부<br>임곗값(warn, fatal)<br>Duration(warn, fatal) | 메모리 사용률(%) 감시 | 메모리 사용률에 두 단계(warn, fatal)로 임곗값 설정<br>설정된 임곗값에 도달 후, Duration으로 지정된 시간 이후에도 해당 상태가 지속될 때 알람 발송 |
| Disk Quota | 사용 여부<br>임곗값(warn, fatal)<br>Duration(warn, fatal) | 디스크 공간 사용률(%) 감시 | 디스크 공간 사용률에 두 단계(warn, fatal)로 임곗값 설정<br>설정된 임곗값에 도달한 후, Duration으로 지정된 시간 이후에도 해당 상태가 지속될 때 알람 발송<br><br>*[참고] 디스크가 여러 개일 때, 개별적으로 적용됨* |
| Network  | 사용 여부<br>임곗값(warn, fatal)<br>Duration(warn, fatal) | 네트워크 전송률(Bps) 감시 | 네트워크 전송률에 두 단계(warn, fatal)로 임곗값 설정<br>설정된 임곗값에 도달 후, Duration으로 지정된 시간 이후에도 해당 상태가 지속될 때 알람 발송<br><br>*[참고] 네트워크 장치가 여러 개일 때, 개별적으로 적용됨*<br>*[참고] 여기서 설정되는 임곗값은 개별 네트워크 장치의 Network RX + TX(전체 송수신율의 합)를 의미* |
| 인스턴스 목록 | 적용 여부 | 해당 정책을 적용할 인스턴스 지정 | 선택된 인스턴스에 해당 정책 기반의 감시 기능을 사용함 |


## 알람 수신 설정
**Users** 탭에서는 알람 수신자 및 수신 방법을 설정할 수 있습니다.

![alarm user<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_005.jpg)

프로젝트 사용자 목록에서 원하는 사용자에 대한 알람 수신 방식(이메일 혹은 휴대폰)을 선택한 후, **신청** 버튼을 누르면 설정 내역이 저장됩니다.
이후 해당 사용자에게 지정된 방식으로 알람이 발송됩니다.
알람 수신을 해제하려면 역시 같은 방식으로 설정 내역을 변경하면 됩니다.

알람 상황이 감지되면 설정 내역을 기반으로 알람 메시지가 발송됩니다.
또한 최초 알람 발송 후, 아래 기준으로 최대 3회의 추가 알람을 발송할 수 있습니다.
(단, 재부팅 감지 알람은 아래에 해당하지 않습니다.)

| 추가 알람 발송 시점 | 설명 |
| ----------| -----|
| 10분 후   | 최초 알람 발송 후, 해당 상태가 10분 이상 지속되는 경우 |
| 한 시간 후 | 최초 알람 발송 후, 해당 상태가 한시간(60분) 이상 지속되는 경우 |
| 하루 후   | 최초 알람 발송 후, 해당 상태가 하루(1440분) 이상 지속되는 경우 |

>[참고] OK 알람 발송
> 인스턴스의 상태가 정상화되면, 이를 알려주는 OK 알람이 1회 발송됩니다.


## 알람 이력 조회
**Alarm Logs** 탭에서 알람 이력을 조회할 수 있습니다.
각 알람 이력은 알람을 최초로 발송했을 때 생성됩니다.

![alarm logs image<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_006.jpg)

알람 이력은 다음과 같은 항목으로 구성됩니다.

| 항목         | 설명  |
|--------------|-----------|
| Server 이름  | 알람이 발생된 인스턴스 이름 |
| IP 주소   | 인스턴스의 IP 주소 |
| 날짜         | 알람이 발송된 시각 |
| 계량         | 알람이 발생된 지표 |
| 이벤트 감지  | 알람 발생 시점의 지푯값 |
| 임곗값       | 해당 지표에 설정된 임곗값 |
| 알람 보내기 | 알람 발송 여부 |

인스턴스 이름이나 IP 주소로 검색해 원하는 인스턴스의 이력을 확인할 수 있습니다.
또한 기간 설정 버튼을 사용해 원하는 시점의 이력을 확인할 수도 있습니다.

> [참고]
> 알람 이력 조회 가능 시점은 현재를 기준으로 과거 1년까지입니다.

| 버튼    | 설명  |
|---------|-----------|
| 1일   | 현재를 기준으로 지난 하루 동안의 알람 이력 조회 |
| 1주  | 현재를 기준으로 지난 한 주 동안의 알람 이력 조회 |
| 1달 | 현재를 기준으로 지난 한 달 동안의 알람 이력 조회 |
| 지정  | 사용자가 직접 조회 시점을 지정(시작 시점 및 종료 시점) |


## 모니터링 에이전트 참고 사항
| 항목 | 설명 |
| -----| -----|
| 데이터 수집 주기 | 모니터링 에이전트는 1분 주기로 데이터를 수집하고 전송합니다. |
| 네트워크 - 포트 설정 | 에이전트의 정상 동작을 위해서는 TCP 송신(egress) 포트 80과 6600이 보안 그룹에서 허용되어야 합니다.<br>TOAST Compute 서비스에서 제공하는 기본 보안 그룹(default security group)을 그대로 사용할 때는 에이전트 동작에 문제가 없습니다.<br>[주의] 보안 그룹을 수정해 TCP 송신(egress) 포트를 직접 조작하는 경우, 80과 6600 포트를 허용해야 합니다. |
| 네트워크 - 인터넷 게이트웨이 설정 | 모니터링 에이전트가 수집한 데이터를 수집 서버로 전송하려면 인터넷 게이트웨이가 있어야 합니다.<br> TOAST Network 서비스의 기본 설정을 따르는 경우 에이전트 동작에 문제가 없습니다.<br>인터넷 게이트웨이를 삭제하면, 해당 네트워크에 연결된 인스턴스의 모니터링 기능을 사용할 수 없습니다. |
| 에이전트 프로세스 강제 종료 | 구동 중인 에이전트 프로세스를 중단하면, Monitoring V2의 기능을 제대로 사용할 수 없게 됩니다. |

Monitoring V2 서비스를 정상적으로 사용하기 어렵다면 [TOAST 고객 센터](https://www.toast.com/support)로 문의해 주시기 바랍니다.

