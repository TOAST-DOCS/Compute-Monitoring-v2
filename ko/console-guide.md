## Compute > Monitoring v2 > 콘솔 사용 가이드


## 단일 인스턴스에 대한 상태 조회하기(인스턴스 관리 페이지에서 제공)

Toast 콘솔의 'Compute > Instance > 관리 > `조회 대상 인스턴스 선택` > Monitoring 탭'에서는 해당 인스턴스의 모니터링 그래프를 조회할 수 있습니다.

> [알림]
> Monitoring v2 서비스 제공 이전에 생성된 인스턴스에 대해 본 기능을 사용하기 위해서는, 해당 인스턴스의 'Monitoring 탭'에서 제공되는 설치 가이드를 따라 에이전트를 설치해야 합니다.<br>
> 에이전트 설치 후 'Monitoring 탭'에서 그래프가 노출되면, 그 시점부터 Monitoring v2의 기능을 활용할 수 있게 됩니다.


![cpu usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_001.jpg) 

각 그래프에 대한 설명은 다음과 같습니다.

| 그래프 | 설명  | 
|:--------|-------|
|CPU 사용률    <br>![cpu usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_001.jpg)    | `이미지 수정 필요(total 포함된 것으로)`<br>total: 총 CPU 사용률<br>sys: 커널 모드 작업에 소요된 CPU 사용률<br>usr: 유저 모드 작업에 소요된 CPU 사용률 |
|CPU 부하 평균 <br>![cpu load image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_002.jpg)     | `이미지 수정 필요(legend 수정된 것으로)`<br>1m: 지난 1분 동안 CPU를 사용(대기 상태 포함)한 프로세스 개수의 평균<br>5m: 지난 5분 동안 CPU를 사용(대기 상태 포함)한 프로세스 개수의 평균<br>15m: 지난 15분 동안 CPU를 사용(대기 상태 포함)한 프로세스 개수의 평균<br> *[참고] 본 지표는 linux 운영체제 전용 지표입니다.<br>(windows 인스턴스에서는 그래프는 노출되지만 데이터는 제공되지 않습니다.)* |
|Memory 사용률 <br>![memory usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_003.jpg) | pused: 메모리 사용률<br>swappused: 스왑 사용률<br>*[참고] linux 인스턴스는 메모리 사용률 계산 시 buffer 및 cache 영역은 사용 가능한 영역으로 간주하여 사용량에 포함시키지 않습니다.* |
|Disk 사용률   <br>![disk usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_004.jpg)   | `이미지 수정 필요(그래프 이름 수정된 것으로)`<br>io: Disk 장치 사용률<br> used: Disk 공간 사용률<br>[참고] io 및 used는 파일 시스템(혹은 디스크 파티션) 별로 제공됨 |
|Disk 전송률   <br>![disk i/o image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_005.jpg)     | `이미지 수정 필요(그래프 이름 수정된 것으로)`<br>read: 디스크 읽기 전송률<br>write: 디스크 쓰기 전송률<br>[참고1] read 및 write는 파일 시스템(혹은 디스크 파티션) 별로 제공됨<br>[참고2] 기본 단위는 Bps(Bytes per Sec)이며, 크기에 따라 y축 단위가 변환됨 |
|Network 전송률<br>![network i/o image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_006.jpg)  | `이미지 수정 필요(그래프 이름 수정된 것으로)`<br>In: 네트워크 읽기 전송률<br>Out: 네트워크 쓰기 전송률<br>[참고1] In 및 Out은 네트워크 장치 별로 제공됨<br>[참고2] 기본 단위는 bps(Bits per Sec)이며, 크기에 따라 y축 단위가 변환됨 |

여기서 제공되는 모든 그래프는 '조회 시점을 기준으로 지난 5분 간의 데이터'를 제공하며, 자동 갱신 기능은 제공되지 않습니다.
대신 그래프 영역 왼쪽 상단의 `새로 고침` 버튼을 이용하면 최신 데이터를 조회할 수 있습니다. (수동 갱신 기능 제공)



## 복수 인스턴스에 대한 상태 조회하기
Server Details 탭(아래 그림)의 각 그래프에서는 선택한 인스턴스에 대한 지표를 동시에 보여줍니다.
![server details image<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_007.jpg)

### 1.인스턴스 목록 (화살표 1 영역)
에이전트 구동 이력이 있는 인스턴스의 목록이 제공됩니다.
> [참고]
> 에이전트 구동 이력이 있으나 현재 에이전트가 종료된 인스턴스, 혹은 종료 상태의 인스턴스도 해당 목록에 포함됩니다. 
> 이와 같은 인스턴스는 상태 필드 값이 'inActive'로 표시됩니다.

목록에서 선택된 인스턴스는 그래프에 자동으로 반영됩니다.(복수 선택 가능)

인스턴스 목록을 통해서도 각 인스턴스에 대한 기본 정보 및 리소스 사용률(조회/갱신 시점 기준)을 확인할 수 있습니다.
모든 필드에 대한 검색 기능을 이용하면 원하는 대상을 쉽게 골라서 볼 수 있습니다.

### 2.그래프 (화살표 2 영역)
모니터링 탭과 마찬가지로 6개의 그래프를 제공하지만, 여기서의 각 그래프는 선택된 모든 인스턴스에 대한 지표를 동시에 제공합니다.

>[참고]
>다음의 두 그래프는 모니터링 탭에서와는 달리 일부 지표만 제공됩니다.<br>
>CPU Usage 그래프: 각 인스턴스에 대해 total 사용률만 제공
>Memory Usage 그래프: 각 인스턴스에 대해 memory 사용률(pused)만 제공

임의의 그래프 위에 마우스 커서를 올려 놓으면, 커서가 가리키는 시점(x축)의 지표값이 표시됩니다.
또한 커서를 올려 놓지 않은 그래프에서도 동일한 시점의 지표값이 함께 표시(shared-tooltip)됩니다.

>[주의]
>선택된 인스턴스의 개수가 많은 경우, 그래프의 가독성이 떨어질 수 있습니다.

### 3.조회 기간 지정 (화살표 3 영역)
그래프 조회 기간 설정 기능을 통해 원하는 시점의 인스턴스 상태를 확인할 수 있습니다.
> [참고]
> 그래프 조회 가능 기간은 최대 ??? 개월입니다.

| 설정 항목  | 의미  |
| ---------- | ----- |
| 1 hour  | 조회 시점 기준으로 지난 한시간 동안의 데이터 조회 |
| 24 hour | 조회 시점 기준으로 지난 하루 동안의 데이터 조회 |
| 1 week  | 조회 시점 기준으로 지난 일주일 동안의 데이터 조회 |
| 1 month | 조회 시점 기준으로 지난 한달 종안의 데이터 조회 |
| Custom  | 사용자가 직접 조회 시점을 지정(시작 시점 및 종료 시점) |

### 4.그래프 갱신 주기 설정 (화살표 4 영역)
모든 그래프에 대해서 자동 갱신 기능을 제공합니다.
'off'로 설정된 경우에는 그래프 자동 갱신을 수행하지 않습니다.
'off'가 아닌 경우에는 해당 값으로 표시되는 시간을 주기로 그래프가 자동 갱신됩니다.

## 알람 정책 설정하기
Alarm Setting 탭에서는 알람 정책 목록 조회 및 알람 정책 생성/수정/삭제 기능을 제공합니다.
알람 정책은 인스턴스 상태 감시를 위한 각종 설정 내역을 담고 있으며, 이를 기준으로 사용자는 인스턴스 상태에 따른 알람을 받을 수 있습니다.

>[주의]
>알람을 받기 위해서는 별도의 [알람 수신자 및 수신 방법 설정](./console-guide/#_4)이 필요합니다.

알람 정책을 통해 감시 가능한 항목은 다음과 같습니다.
>[참고] 아래 표에서의 '설정 항목' 필드에 대한 설명<br>
> 사용 여부: 해당 항목에 대한 사용 여부를 설정(on/off)<br>
> 임계값: 해당 항목에 대해 알람을 받길 원하는 상태의 최소값. warn 및 fatal의 두단계로 설정 가능<br>
> Duration: 해당 항목의 설정 내역(사용 여부 및 임계값)에 따른 이벤트 감지 후, 실제로 알람을 발송하기까지 해당 상태가 지속되어야 하는 시간(즉, 해당 상태가 Duration으로 지정된 시간 이내에 해소되는 경우 알람은 발생하지 않음)<br>

| 감시 대상 | 설정 항목 | 용도 | 설명 |
|-----------|-----------|------|------|
| 재부팅 | 사용 여부 | 인스턴스 재부팅에 대한 감시 | 인스턴스 재부팅이 완료된 시점에 알람 발생<br>[참고] 재부팅 알람 발송 후 `10분 이내의 재부팅`은 무시함(알람 발송 안함) |
| No Data | 사용 여부<br>Duration |에이전트의 데이터 미전송 상태에 대한 감시 | 데이터 미전송 상태 최초 감지 후, Duration으로 설정된 시간 동안 계속해서 해당 상태가 지속되는 경우 알람 발송 |
| CPU | 사용 여부<br>임계값(warn, fatal)<br>Duration(warn, fatal) | CPU 사용률(%)에 대한 감시 | 총 CPU 사용률에 대해 두단계(warn, fatal)로 임계값 설정<br>설정된 임계값에 도달 후, Duration으로 지정된 시간 동안 해당 상태가 지속될 때 알람 발송 |
| 메모리 | 사용 여부<br>임계값(warn, fatal)<br>Duration(warn, fatal) | Memory 사용률(%)에 대한 감시 | Memory 사용률에 대해 두단계(warn, fatal)로 임계값 설정<br>설정된 임계값에 도달 후, Duration으로 지정된 시간동안 해당 상태가 지속될 때 알람 발송 |
| Disk Quota | 사용 여부<br>임계값(warn, fatal)<br>Duration(warn, fatal) | Disk 공간 사용률(%)에 대한 감시 | Disk 공간 사용률에 대해 두단계(warn, fatal)로 임계값 설정<br>설정된 임계값에 도달 후, Duration으로 지정된 시간동안 해당 상태가 지속될 때 알람 발송<br>복수의 Disk가 존재하는 경우 각각에 대해 개별적으로 적용됨 |
| Network  | 사용 여부<br>임계값(warn, fatal)<br>Duration(warn, fatal) | Network 전송률(bps)에 대한 감시 | Network 전송률에 대해 두단계(warn, fatal)로 임계값 설정<br>설정된 임계값에 도달 후, Duration으로 지정된 시간동안 해당 상태가 지속될 때 알람 발송<br>복수의 Network Device가 존재하는 경우 각각에 대해 개별적으로 적용됨<br>[참고] 여기서 설정되는 임계값은 network rx + tx(전체 송수신률의 합)를 의미함. |
| 인스턴스 | 적용 여부 | 해당 정책을 적용할 인스턴스 설정 | 선택된 인스턴스에 대해서 해당 정책 기반의 감시 기능을 사용함 |

알람 상황 감지에 따른 최초 알람 발송 후, 아래와 같은 기준으로 최대 3회의 추가 알람이 발송될 수 있습니다.
(단, 재부팅 감지 알람은 아래에 해당하지 않습니다.)

| 추가 알람 발송 시점 | 설명 |
| ----------| -----|
| 10분 후   | 최초 알람 발송 후, 해당 상태가 10분 이상 지속되는 경우 |
| 한시간 후 | 최초 알람 발송 후, 해당 상태가 한시간(60분) 이상 지속되는 경우 |
| 하루 후   | 최초 알람 발송 후, 해당 상태가 하루(1440분) 이상 지속되는 경우 |

>[참고] OK 알람 발송에 대하여
> 인스턴스의 상태가 정상화되는 경우, 이를 알려주는 OK 알람이 1회 발송됩니다.

Monitoring v2 서비스에서는 기본적으로 `Default 정책`을 제공하며, 이 정책은 수정 가능하나 삭제는 불가능합니다.
또한 사용자에 의한 알람 정책의 생성, 수정 및 삭제 기능도 제공합니다.

>[참고]
>모니터링 서비스 등록(에이전트 최초 구동 시 수행) 직후의 인스턴스에 대해서는 Default 정책이 적용되며, 언제든지 사용자에 의해 다른 정책의 적용이 가능합니다.
>또한 모든 인스턴스는 오직 하나의 정책만 적용 가능합니다.


## 알람 수신 설정하기
Users 탭에서는 알람 수신자 및 수신 방법에 대한 설정 기능을 제공합니다.

프로젝트 사용자 목록에서 원하는 사용자에 대한 알람 수신 방식(이메일 혹은 핸드폰)을 체크한 후, *신청 버튼*을 누르면 설정 내역이 저장됩니다.
이후 해당 사용자에게 지정된 방식을 통해 알람이 발송됩니다.
알람 수신 해제를 원하는 경우 역시 같은 방식으로 설정 내역을 변경하시면 됩니다.


## 알람 이력 조회하기
Alarm Logs 탭에서는 알람 이력 조회 기능을 제공합니다.
각 알람 이력은 알람 상황 발생으로 인한 최초 알람 발송 시 생성됩니다.

알람 이력은 다음과 같은 항목으로 구성되어 있습니다.

| 항목         | 설명  | 
|--------------|-----------|
| Server 이름  | 알람을 발생시킨 인스턴스 이름 |
| IP Address   | 인스턴스의 IP 주소 |
| 날짜         | 알람이 발송된 시각 |
| 계량         | 알람을 발생시킨 지표 |
| 이벤트 감지  | 알람을 발생시킨 시점의 지표 값 |
| 임계값       | 해당 지표에 대해 설정된 임계값 | 
| Alarm 보내기 | 알람 발송 여부 |

인스턴스 이름 혹은 IP 주소를 이용한 검색 기능을 통해 원하는 인스턴스에 대한 이력 조회가 가능합니다.
또한 아래와 같은 기간 설정 버튼을 통해 원하는 시점의 이력을 조회할 수도 있습니다.

| 버튼    | 설명  | 
|---------|-----------|
| 1 day   | 조회 시점 기준으로 지난 하루 동안의 알람 이력 조회 |
| 1 week  | 조회 시점 기준으로 지난 한주 동안의 알람 이력 조회 |
| 1 month | 조회 시점 기준으로 지난 한달 종안의 알람 이력 조회 |
| Custom  | 사용자가 직접 조회 시점을 지정(시작 시점 및 종료 시점) |


## 모니터링 에이전트에 대한 참고 사항
| 항목 | 설명 |
| -----| -----|
| 데이터 수집 주기 | 모니터링 에이전트는 5초 주기로 데이터를 수집 및 전송합니다. |
| 네트워크 - 포트 설정 | 에이전트의 정상 동작을 위해서는 TCP egress port 80 및 6600이 security group에서 허용되어야 합니다.<br>Toast Compute 서비스에서 제공하는 default security group을 그대로 사용하는 경우에는 에이전트 동작에 문제가 없습니다.<br> 만약 security group 수정 등을 통해 TCP egress port를 직접 조작할 경우, 80 및 6600 포트는 허용되어야 함에 주의해 주시기 바랍니다. |
| Network - 인터넷 게이트웨이 설정 | 모니터링 에이전트가 수집한 데이터를 수집 서버로 전송하기 위해서는 인터넷 게이트웨이가 존재해야 합니다.<br> Toast Network 서비스의 기본 설정을 따르는 경우 에이전트 동작에 문제가 없습니다.<br> 만약 사용자 필요에 의해 인터넷 게이트웨이를 삭제하는 경우, 해당 네트워크에 연결된 인스턴스에 대한 모니터링 기능의 사용이 불가능함을 참고해 주시기 바랍니다. |
| 에이전트 프로세스 강제 종료 | 구동 중인 에이전트 프로세스를 임의로 중단시키는 경우, Monitoring v2의 기능을 제대로 사용할 수 없게 됩니다. |

상기 내용을 참고하여, 설정에 문제가 없음에도 그래프가 정상적으로 표시되지 않는 경우에는 Toast 고객센터로 문의주시기 바랍니다.

