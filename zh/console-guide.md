## Compute > Monitoring V2 > 控制台使用指南


## 查询单一实例状态（在实例管理页面提供）

在TOAST控制台中选择**Compute > Instance > 管理**。选择“要查询的实例”。在界面下方**监控**标签中可以查询该实例的监控图表。

> 【警报】
> 若欲在提供Monitoring V2服务之前对创建的实例使用此功能，应按照该实例的**监控**标签中提供的安装指南安装代理程序。<br>
> 安装代理程序后若在**监控标签**中显示图表，则从此时开始可使用Monitoring V2的功能。

所有图表以查询时间为准，显示“过去1小时”内的数据，无自动更新功能。
但单击图表区左上方的**刷新**按钮，可以确认最新数据（手动更新功能）。

![CPU usage image <](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_001.jpg) 

各图表简单介绍如下。

| 图表        |  指标说明          |
|:--------------|----------------|
|CPU使用率     | total: 总CPU使用率（%）<br>sys: 内核模式操作所需的CPU使用率（%）<br>usr: 用户模式操作所需的CPU使用率（%） |
|CPU平均负载  | 1m: 过去1分钟内使用CPU的进程数（包括等待状态）的平均值<br>5m: 过去5分钟内使用CPU的进程数（包括等待状态）的平均值<br>15m: 过去15分钟内使用CPU的进程数（包括等待状态）的平均值<br><br> *【参考]】本指标是Linux实例专用指标。<br>（Windows实例显示图表，但不提供数据。）*|
|内存使用率  | pused: 内存使用率（%）<br>swappused: Swap使用率（%）<br><br>*【参考】计算Linux实例的内存使用率时，缓冲区和缓存区视为可用区域，不包括在使用量中。*|
|磁盘使用率    | io: 磁盘设备使用率（%）<br> used: 磁盘空间使用率（%）<br><br>*【参考】io及used按照不同的挂载状态的文件系统（Windows为磁盘驱动器）提供。*|
|磁盘传输率    | read: 磁盘读取传输率（Bps）<br>write: 磁盘写入传输率（Bps）<br><br>*【参考】read及write按照不同的挂载状态的文件系统（Windows为磁盘驱动器）提供。*<br>*【参考】y轴默认单位为Bps（Bytes per Sec），单位根据值的大小变化。*|
|网络传输率 | In: 网络读取传输率（Bps）<br>Out: 网络写入传输率（Bps）<br><br>*【参考】In及Out按照不同的网络设备提供。*<br>*【参考】y轴默认单位为Bps（Bytes per Sec），y轴单位根据值的大小变化。*|




## 查询多个实例状态
在**Server Details** 标签（下图）的各个图表中可同时确认所选实例的指标。
![server details image<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_002.jpg)

### 1、实例列表（箭头1区域）
可确认有代理程序驱动历史的实例列表。
> 【参考】
> 有代理程序驱动历史，但当前代理程序终止的实例，或终止状态的实例也包含在该列表中。 
> 此类实例以状态值显示为“inActive”。

列表中选择的实例自动反映在图表中（可多选）。

在实例列表中也可以查询各实例的基本信息和资源使用率（以查询/更新时间为准）。
>【参考】
> 实例列表的Disk Read, Disk Write值显示该实例的所有磁盘按相同指标合计的值。
> 实例列表的Network RX, Network TX值显示该实例的所有网络设备按相同指标合计的值。

使用所有字段的搜索功能，可轻松选择并查看所需对象。

### 2、图表（箭头2区域）
与**监控**标签相同，虽然提供6个图表，但此处各个图表同时提供所选的所有实例的指标。

>【参考】
>以下两个图表与**监控**标签不同，仅显示部分指标。<br>
>CPU Usage图表：只提供各实例的total使用率
>Memory Usage图表：仅提供各实例的memory使用率（pused）

将鼠标光标放在图表上，显示光标所指的点（x轴）的指标值。
没有放上光标的图表中也同时显示相同点的指标值（shared-tooltip功能）。

>【参考】
>若所选实例个数较多，图表可读性有可能降低。

### 3、指定查询时间段（箭头3区域）
设置图表查询时间段，可确认所需时间的实例状态。
> 【参考】
> 图表可查询时间最长为以当前为准的“过去1年”。

| 设置项目  | 意义  |
| ---------- | ----- |
| 1 hour  | 查询以当前为准过去一小时内的数据 |
| 24 hour | 查询以当前为准过去一天内的数据 |
| 1 week  | 查询以当前为准过去一周内的数据 |
| 1 month | 查询以当前为准过去一个月内的数据 |
| Custom  | 用户自行指定查询时间段（开始时间及结束时间） |

### 4、设置图表更新周期（箭头4区域）
所有图表中可自动使用“刷新”功能。
若设置为“off”，则不“刷新”图表。
若不是“off”，则不以相应值显示的时间为周期自动“刷新”图表。

## 设置警报策略
可在**Alarm Setting**标签中查询警报策略列表，并创建、修改、删除警报策略。

![alarm policy<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_003.jpg)

警报策略含有为监控实例状态的各种设置明细，以此为准，用户可以收到根据实例状态发出的警报。
>【参考】
>若欲接收警报，应另外【设置警报接收方及接收方法】（./console-guide/#_4）。

Monitoring V2服务默认提供“Default策略”，该策略可修改，但不可删除。
>【参考】
>注册监控服务（代理程序首次驱动时执行）后的实例应用Default策略。
>欲应用于实例的警报策略可随时更改。

>【注意】
>所有实例仅可包含一个警报策略。
>若删除警报策略，应用相应策略的所有实例变为不属于任何警报策略的状态。

可使用警报策略监控的项目如下。
![alarm configuration<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_004.jpg)

>【参考】下表的“设置项目”字段值说明<br>
> 是否使用：设置是否使用该项目（on/off）<br>
> 阈值：欲接收该项目警报的状态的最小值。可设置为warn与fatal两个阶段<br>
> Duration:根据该项目的设置明细（是否使用及阈值）监测事件后，至实际发出警报前，该状态应持续的时间（即，若在Duration指定的时间内消除相应状态，则不发出警报）<br>

| 监控对象 | 设置项目 | 用途 | 说明 |
|-----------|-----------|------|------|
| 重启 | 是否使用 | 监控实例重启 | 实例重启完成时发出警报<br><br>*【参考】 忽略发送重启警报后“10分钟以内的重启”（不发送警报）* |
| No Data | 是否使用<br>Duration |监测未发送代理程序数据状态 | 首次监测到未发送数据后，在Duration中设置的时间内持续该状态时，发送警报 |
| CPU | 是否使用<br>阈值（warn, fatal）<br>Duration（warn, fatal） | 监测CPU使用率（%） | 总CPU使用率分两个阶段（warn, fatal）设置阈值<br>达到设置的阈值后，利用Duration指定的时间后仍持续该状态时，发送警报 |
| 内存 | 是否使用<br>阈值（warn, fatal）<br>Duration（warn, fatal） | 监测内存使用率（%） | 内存使用率分两个阶段（warn, fatal）设置阈值<br>达到设置的阈值后，利用Duration指定的时间后仍持续该状态时，发送警报 |
| Disk Quota | 是否使用<br>阈值（warn, fatal）<br>Duration（warn, fatal） | 监测磁盘空间使用率（%） | 磁盘空间使用率分两个阶段（warn, fatal）设置阈值<br>达到设置的阈值后，利用Duration指定的时间后仍持续该状态时，发送警报<br><br>*【参考】如果有多个磁盘，则分别应用* |
| Network  | 是否使用<br>阈值（warn, fatal）<br>Duration（warn, fatal） | 监测网络传输率（Bps） | 磁盘空间使用率分两个阶段（warn, fatal）设置阈值<br>达到设置的阈值后，利用Duration指定的时间后仍持续该状态时，发送警报<br><br>*【参考】如果有多个网络设备，则分别应用*<br>*【参考】此处设置的阈值表示各网络设备的Network RX + TX（整体传输接受率之和）* |
| 实例列表 | 是否应用 | 指定要应用该策略的实例 | 对所选实例使用基于该策略的监测功能 |


## 设置接收警报
在**Users**标签中可以设置警报接收方与接收方法。

![alarm user<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_005.jpg)

在项目用户列表中选择所需用户的警报接收方式（邮件或手机）后，按**申请**按钮，即可保存设置明细。
此后将按照指定的方式向用户发送警报。
若欲取消接收警报，按照同样的方式更改设置明细即可。

若检测到警报状况，则按照设置明细发送警报信息。
首次发送警报后，可按照以下标准最多发送3次附加警报。
（但，重启检测警报不适用以下标准。）

| 发送附加警报时间 | 说明 |
| ----------| -----|
| 10分钟后   | 首次发送警报后，相应状态持续10分钟时 |
| 一小时后   | 首次发送警报后，相应状态持续一小时（60分钟）时 |
| 一天后   | 首次发送警报后，相应状态持续一天（1440分钟）时 |

>【参考】 发送OK警报
> 实例状态恢复正常后，发送1次通知此情况的OK警报。


## 查询警报历史
在**Alarm Logs**标签中可查询警报历史。
各警报历史在首次发送警报时创建。

![alarm logs image<](http://static.toastoven.net/prod_infrastructure/monitoring/v2/image_006.jpg)

警报历史由以下项目构成。

| 项目         | 说明  |
|--------------|-----------|
| Server名  | 发出警报的实例名 |
| IP地址   | 实例的IP地址 |
| 日期         | 发送警报的时间 |
| 计量         | 发出警报的指标 |
| 事件检测  | 发出警报时的指标值 |
| 阈值       | 为相应指标设置的阈值 |
| 发送警报 | 是否发送警报 |

利用实例名或IP地址搜索，可确认所需实例的历史。
使用时间设置按钮，还可以查询所需时间的历史。

> 【参考】
> 警报历史可查询时间最长为以当前为准的过去1年。

| 按钮    | 说明  |
|---------|-----------|
| 1天   | 查询以当前为准过去一天内的警报历史 |
| 1周   | 查询以当前为准过去一周内的警报历史 |
| 1月   | 查询以当前为准过去一个月内的警报历史 |
| 指定  | 用户自行指定查询时间（开始时间及结束时间） |


## 监控代理程序参考事项
| 项目 | 说明 |
| -----| -----|
| 数据收集周期 | 监控代理程序以1分钟为周期收集并传送数据。|
| 网络-端口设置 | 为保证代理程序的正常运行，应在安全组中允许使用TCP发送（egress）端口80和6600。<br>使用TOAST Compute服务提供的默认安全组（default security group）时，代理程序操作无问题。<br>【注意】修改安全组直接操作TCP发送（egress）端口时，应允许使用80和6600端口。|
| 网络-互联网网关设置 | 若欲将监控代理程序收集的数据传送至收集服务器，应有互联网网关。<br>遵循TOAST Network服务的默认设置时，则代理程序操作无问题。<br>若删除互联网网关，则无法使用连接到相应网络的实例的监控功能。|
| 强制终止代理程序进程 | 若中断驱动中的代理程序进程，则无法正常使用Monitoring V2的功能。|

若难以正常使用Monitoring V2服务，请咨询【TOAST客服中心】（https://www.toast.com/support）。

